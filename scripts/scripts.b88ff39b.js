"use strict";angular.module("rutasApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","uiGmapgoogle-maps"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).otherwise({redirectTo:"/"})}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyBpMZTqGZ9tPwNjBqBBwoBenCUuQEK9yNI",v:"3.17",libraries:"weather,geometry,visualization"})}]),angular.module("rutasApp").directive("resize",["$window",function(a){return function(b,c){var d=angular.element(a);b.getWindowDimensions=function(){return{h:d.height(),w:d.width()}},b.$watch(b.getWindowDimensions,function(a,c){b.windowHeight=a.h,b.windowWidth=a.w,b.style=function(){return{height:a.h-angular.element("header")[0].offsetHeight+"px"}}},!0),d.bind("resize",function(){b.$apply()})}}]),angular.module("rutasApp").directive("navButtons",function(){return{restrict:"E",templateUrl:"/views/nav-buttons.html"}}),angular.module("rutasApp").controller("MainCtrl",["$scope","uiGmapGoogleMapApi","$http","RateService","$window",function(a,b,c,d,e){a.rutas=[{id:"01",name:"Ruta 01"},{id:"02",name:"Ruta 02"},{id:"03",name:"Ruta 03"},{id:"04",name:"Ruta 04"},{id:"05",name:"Ruta 05"},{id:"06",name:"Ruta 06"},{id:"07",name:"Ruta 07"},{id:"08",name:"Ruta 08"},{id:"09",name:"Ruta 09"},{id:"10",name:"Ruta 10"},{id:"11",name:"Ruta 11"},{id:"12",name:"Ruta 12"},{id:"14",name:"Ruta 14"},{id:"15",name:"Ruta 15"},{id:"16",name:"Ruta 16"},{id:"18",name:"Ruta 18"},{id:"19",name:"Ruta 19"},{id:"20",name:"Ruta 20"},{id:"21",name:"Ruta 21"},{id:"23",name:"Ruta 23"},{id:"23B",name:"Ruta 23B"},{id:"24",name:"Ruta 24"},{id:"25",name:"Ruta 25"},{id:"27",name:"Ruta 27"},{id:"28",name:"Ruta 28"},{id:"29",name:"Ruta 29"},{id:"30",name:"Ruta 30"},{id:"31",name:"Ruta 31"},{id:"33",name:"Ruta 33"},{id:"34",name:"Ruta 34"},{id:"35",name:"Ruta 35"},{id:"36",name:"Ruta 36"},{id:"37",name:"Ruta 37"},{id:"38",name:"Ruta 38"},{id:"39",name:"Ruta 39"},{id:"40",name:"Ruta 40"},{id:"41",name:"Ruta 41"},{id:"42",name:"Ruta 42"},{id:"43",name:"Ruta 43"},{id:"44",name:"Ruta 44"},{id:"45",name:"Ruta 45"},{id:"46",name:"Ruta 46"},{id:"47",name:"Ruta 47"},{id:"48",name:"Ruta 48"},{id:"50",name:"Ruta 50"}],a.colorRutas=[{ida:"#2ECCFA",regreso:"#FF8000"},{ida:"#0040FF",regreso:"#DF0101"},{ida:"#6A0888",regreso:"#F0ED3B"},{ida:"#B404AE",regreso:"#51D15E"}];var f=-1;a.buspoints=[],a.map={center:{latitude:21.882886,longitude:-102.294878},zoom:13},a.analytics=function(a,b,c){ga("send","event",a,b,c)},a.home=function(){e.location.reload()},a.messageLocation="Mi ubicación",a.userLocation=function(){a.messageLocation="Localizando",navigator.geolocation.getCurrentPosition(function(b){var c=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);console.log(c),a.$apply(function(){a.map={center:{latitude:c.k,longitude:c.D},zoom:14},a.marker={id:1,coords:{latitude:c.k,longitude:c.D}},a.messageLocation="Mi ubicación"})})},a.cleanMap=function(){a.polylines=[],a.marker=[],a.buspoints=[],a.markers={},f=-1,angular.element(".activeRoute").removeClass("activeRoute")},a.selectedRoute=function(a){angular.element("#"+a).addClass("activeRoute")},a.getRoute=function(d){a.markers={},a.windowOptions={visible:!1},a.windowOptions2={visible:!1},c.get("/rutas/"+d+"_ida.json").success(function(c){b.then(function(b){c.stroke.color=a.colorRutas[f].ida,c.icons[0].icon={path:b.SymbolPath.FORWARD_OPEN_ARROW},a.polylines.push(c),a.markers.push={id:d,coords:{latitude:c.path[0].latitude,longitude:c.path[0].longitude}},angular.forEach(c.buspoints,function(b,c){var d={id:b.id,icon:{url:b.image.url,size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,32)},coords:{latitude:b.latitude,longitude:b.longitude}};a.buspoints.push(d)})})}).error(function(a){console.err(a)}),c.get("/rutas/"+d+"_regreso.json").success(function(c){b.then(function(b){c.stroke.color=a.colorRutas[f].regreso,c.icons[0].icon={path:b.SymbolPath.FORWARD_OPEN_ARROW},a.polylines.push(c),a.markers.push={id:d,coords:{latitude:c.path[0].latitude,longitude:c.path[0].longitude}}})}).error(function(a){console.err(a)}),f++,f>3&&(f=0)},a.onRouteClick=function(){a.windowOptions.visible=!a.windowOptions.visible},a.closeRouteClick=function(){a.windowOptions.visible=!1},a.onBusClick=function(b,c){a.closeBusClick(),a.windowOptions2.visible=!a.windowOptions2.visible,a.stopCoords=c,a.buspoint=b,console.log("Bus opened"),console.log(c),console.log(b)},a.closeBusClick=function(){a.windowOptions2.visible=!1,a.stopCoords={latitude:21.882886,longitude:-102.294878},a.buspoint=null,console.log("Bus closed")},b.then(function(b){a.polylines=[{id:7,path:[{latitude:21.971862,longitude:-102.345039}],stroke:{color:"#CC0000",weight:3},editable:!1,draggable:!1,geodesic:!0,visible:!0,icons:[{icon:{path:b.SymbolPath.BACKWARD_OPEN_ARROW},offset:"25px",repeat:"50px"}]}]})}]),angular.module("rutasApp").controller("UserLocationCtrl",["$scope","uiGmapGoogleMapApi",function(a,b){}]),angular.module("rutasApp").controller("CommentsCtrl",["$scope","$modal","$log",function(a,b,c){a.comment=[],Parse.initialize("Z6EWUM9VVRIe5JX3Iw2ZnLB1j2LQn9J0CU0DFXT4","cfs3GctSfGPGANhGS02dqS6JflMBl1WlebkmXcUw"),a.saveComment=function(){var c=Parse.Object.extend("Contact"),d=new c;d.save({name:a.comment.Name,email:a.comment.email,phone:a.comment.phone,category:a.comment.category,comment:a.comment.comment},{success:function(a){console.log("Enviado correctamente");b.open({template:'<div class="modal-body text-center"><alert ng-model="message" type="{{alert}}" close="closeAlert()">{{message}}</alert></div>',controller:"MessageInstanceCtrl",size:null,resolve:{msg:function(){return"Solicitud enviada correctamente"},alert:function(){return"success"}}})},error:function(a,c){console.log("Error al enviar");b.open({template:'<div class="modal-body text-center"><alert ng-model="message" type="{{alert}}" close="closeAlert()">{{message}}</alert></div>',controller:"MessageInstanceCtrl",size:null,resolve:{msg:function(){return"Error: la solicitud no se pudo enviar"},alert:function(){return"danger"}}})}})},a.doComment=function(){var a=b.open({templateUrl:"views/contact.html",controller:"ModalInstanceCtrl",size:null});a.result.then(function(a){},function(){c.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close(a.comment)},a.cancel=function(){b.dismiss("cancel")}}]).controller("MessageInstanceCtrl",["$scope","$modalInstance","msg","alert",function(a,b,c,d){a.message=c,a.alert=d,a.closeAlert=function(){b.close()}}]),angular.module("rutasApp").service("RateService",["$timeout","$modal","$log",function(a,b,c){function d(){e()}function e(){var d=b.open({templateUrl:"views/rate-this-app.html",controller:"ModalRatingCtrl",size:null});d.result.then(function(){a.cancel(f)},function(){c.info("Modal dismissed at: "+new Date),a.cancel(f)})}if(!localStorage.rateDone)var f=a(d,18e4)}]).controller("ModalRatingCtrl",["$scope","$modalInstance","$modal",function(a,b,c){Parse.initialize("Z6EWUM9VVRIe5JX3Iw2ZnLB1j2LQn9J0CU0DFXT4","cfs3GctSfGPGANhGS02dqS6JflMBl1WlebkmXcUw"),a.rate={},a.max=5,a.hoveringOver=function(b){a.overStar=b,a.percent=100*(b/a.max)},a.saveRate=function(){var b=Parse.Object.extend("Rate"),c=new b;c.save({email:a.rate.email,comment:a.rate.comment,stars:a.rate.stars},{success:function(a){localStorage.rateDone=!0},error:function(a,b){}}),a.doRate()},a.doRate=function(){b.close()},a.cancelRate=function(){b.dismiss("cancel")}}]);